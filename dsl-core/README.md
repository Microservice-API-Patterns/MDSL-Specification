# MDSL Xtext Project

MDSL is a Domain-specific Language (DSL) based on [Xtext](https://www.eclipse.org/Xtext/). This folder contains our Xtext project.

## Install Latest Version (Eclipse Plugin)
The latest version of the Eclipse plugin can be installed via the following update site URL:

https://microservice-api-patterns.github.io/MDSL-Specification/updates/

## Use Latest Version Standalone
**Note:** We don't publish the standalone MDSL library into a public Maven repository yet. You can however already test it by building the library locally:

```bash
./gradlew clean publishToMavenLocal
```

You can the use MDSL standalone by including it in your project as follows:

**Gradle:**

```gradle
implementation 'io.mdsl:mdsl-core:{latestMDSLVersion}'
```

**Maven:**

```xml
<dependency>
  <groupId>io.mdsl</groupId>
  <artifactId>mdsl-core</artifactId>
  <version>{latestMDSLVersion}</version>
</dependency>
```

## Build Locally
This project contains two builds:

 * Maven (builds Eclipse plugins)
 * Gradle (builds standalone and CLI JAR's)
 
The Maven build has been generated by the Xtext framework and creates Eclipse plugins only (via Tycho). For creating standalone JAR's (Maven artifacts) and the CLI (fat JAR) we created our own Gradle build.

### Build Eclipse Plugin
You need Maven installed on your machine to build the Eclipse plugin.
Build the project with the following command: (must be executed in this directory)

```bash
mvn clean verify
```

### Build Standalone Library
You don't have to install Gradle locally, since this project uses the Gradle wrapper. Just run the following command to build the standalone artifacts (no leading `./` required on Windows):

```bash
./gradlew clean build # sometimes ./gradlew build is sufficient
```

If you want to install the library in your local Maven repository, use the following command:

```bash
./gradlew clean publishToMavenLocal
```

## IDE Setup
If you want to work on our Xtext project you can import the project into Eclipse (you have to use Eclipse for Xtext) as a Maven project. Ensure that your local (cloned) state builds with `mvn clean verify` before you import the project to Eclipse.

_Hint:_ Ensure you have the Xtext framework installed in your Eclipse. We recommend to use the [Eclipse IDE for Java and DSL Developers](https://www.eclipse.org/downloads/packages/release/2020-03/r/eclipse-ide-java-and-dsl-developers).

### Tycho Configurator
Before you import the project, ensure that the **Tycho configurator** is installed. You can install it in your Eclipse with the following procedure:

 1. Open the maven preferences page: _Window -> Preferences -> Maven_
 2. Under _Discovery_ press the button _Open Catalog_ and search for _Tycho_. You should find the _Tycho Configurator_ there.
 3. Select the Configurator and press _Finish_.
 4. An eclipse installation wizard will appear. Go through the wizard to finish the installation and restart Eclipse.

### Import the Project
Import the project into your Eclipse IDE as follows:

 1. In the menu open _File -> Import ..._
 2. Search for _maven_ and start the _Existing Maven Projects_ wizard.
 3. Browse to the _dsl-core_ directory of this repository and select it.
 4. Press _Select All_ to import all projects.
 5. Press _Finish_ to import the project.
 
### Cleaning Build Errors in Eclipse
Once you imported the project into Eclipse it is likely that you will have build errors. To build the project in Eclipse without errors, follow these steps:

 1. Load and set the target platform:
    1. Open the file `io.mdsl.target/io.mdsl.target.target`
    2. Wait until Eclipse resolved all the dependencies
    3. Click _Set as Active Target Platform_ (or _Reload Target Platform_ in case you already set it once)
 2. Run the MWE2 workflow:
    1. Find the following file in the project explorer: `io.mdsl/src/io/mdsl/GenerateAPIDescription.mwe2`
    2. Right-click on the file and press _Run As_ -> _MWE2 Workflow_
 3. Build all project:
    1. In the main menu click: _Project_ -> _Clean..._
    2. Select _Clean all projects_
    3. Press _Clean_
 
 ## Build Eclipse Update Site Locally
 The Maven build of the project creates an Update Site as ZIP file. You can use the ZIP file to install the MDSL plugin in any Eclipse IDE.
 
 1. Run `mvn clean verify` in the `dsl-core` directory of this repository.
 2. Find the ZIP file here: `dsl-core/io.mdsl.repository/target/io.mdsl.repository-x.y.z-SNAPSHOT.zip`
 3. Use the ZIP file to install the MDSL plugin in Eclipse:
    1. _Help -> Install New Software..._
    2. Press _Add..._ and then _Archive..._ 
    3. Select the ZIP file builded above.
    4. Press _Add_.
    5. Press _Select All_ and then _Next >_.
    6. Finish the installation wizard and restart Eclipse.

## Upgrading Snapshot Version
To update all the POM and MANIFEST files to a new snapshot version, use the following two commands:

 1. `mvn versions:set -DgenerateBackupPoms=false -DnewVersion=x.y.z-SNAPSHOT` (replace _x.y.z_ with the preferred version)
 2. `mvn org.eclipse.tycho:tycho-versions-plugin:1.2.0:update-eclipse-metadata` (do *not* replace 1.2.0, which is the version of the Tycho plugin; *note:* in 2024, the tycho plugin version is 1.7.0!)

Having the two commands executed, you can commit the changed pom.xml's, MANIFEST.MF's and feature.xml files. You may want to build again from scratch too (see above). 

<!--
## Create a new MDSL Release
The step by step process that explains how the MDSL tool is released can be found [here](./RELEASING.md). 
-->

## Context Mapper 
Context Mapper can generate MDSL from bounded contexts and their aggregates. So you might want to install it too.

[This Context Mapper documentation page](https://github.com/ContextMapper/context-mapper-dsl/wiki/IDE-Setup) provides further information and instructions.
